# 데이터 모델
## 1. 객체, 값, 형

**Cpython Implementation detail**
- 현재 참조 횟수 계산(reference - counting)을 사용한다
- 열린 파일같은 외부의 자원들에 대한 참조도 계산 하기 때문에 그런 객체는 명시적으로 닫아야한다(close)

**가변, 불변**
- 불변형은 같은 값을 가리키면 같은 id를 가질 수 있다(a=1, b=1, a=b)
- 가변형은 같은 값이라도 다른 id를 가진다 (a=[], b=[], a != b / a=b=[]일 경우 같다)



> 객체
- 데이터를 추상화 한것이다
- 모든 객체는 아이덴티티(identity), 형(type), 값(value)
- is 연산자는 두 객체의 id를 비교한다 

> 참조 횟수 계산 방식(reference counting)
- 메모리를 제어하는 방법 중 하나로, 가비지 콜렉팅의 한 방식이
- 참조값이 0이 되면 더이상 유효한 객체로 보지 않아 메모리에서 제거한다.
- 매번 참조할 때마다 참조값을 검사해야 하므로 많은 수의 단위 객체를 사용하게 되면 그 검사에 대한 부하가 커진다. 
- 방식
    - 보통 참조계산은 깊은 참조를 말하며, 순환 참조 오류를 해결하기 위해 얕은 참조를 사용하기도 한다
- 문제점
    - 참조하는 객체 사이에 서로 참조하게 되면 ***순환 참조 오류***로 인해 잘못된 참조 파괴가 생기거나 또는 단위 객체가 고아(orphaned)가 될 수 있다.
- https://ko.wikipedia.org/wiki/%EC%B0%B8%EC%A1%B0_%ED%9A%9F%EC%88%98_%EA%B3%84%EC%82%B0_%EB%B0%A9%EC%8B%9D

## 2. 표준형 계층
### 내장된 객체타입
- ***None***
    - 하나의 값만 갖는다
    - 객체에는 내장된 이름 None을 통해 접근한다
    - 함수의 return이 반환하는 값이 없으면 이값이 반환된다
    - 논리값은 False 이다

- ***NotImplemented***
    - 하나의 값만 갖는다
    - 내장된 이름 NotImplemented을 통해 접근한다
    - 숫자(numeric), 비교(richc comparison) 메서드의 피연산자가 연산이 구현되지 않으면 이값을 반환한다
    - 불리언 문맥에서 폐지되서(v3.9) 평가되지 않는다

- ***Ellipsis (생략)***
    - 하나의 값만 갖는다
    - 리터럴 ... 이나 내장된 이름 Ellipsis을 통해 접근
    - 논리값은 True 이다
    - 다차원 데이터배열을 쉽게 처리하기위해 존재
        - fastAPI 에서 다른용도로 쓰임
        - [자세한 설명](https://tech.madup.com/python-ellipsis/)
    - 예제
        ```py
        import numpy as np
        arr = np.array([[[1,2,3],
                         [4,5,6]],
                        [[8,9,10],
                         [11,12,13]]])
        # ... 이 Ellipsis객체 이다
        print(arr[1,...])
        # 1인덱스의 면을 반환한다

        print(arr[...,0])
        # 모든 면의 0인덱스의 열 값을 반환
        ```
- ### ***numbers.Number***
    - 숫자 계층의 최상위 클래스이다
    - 정수형, 실수형, 복소수형이 있다
    - ***numbers.Integral***
        - 정수 집합(양과 음)을 나타낸다
            - int 
                - 2, 8, 10, 16진수 값도 int형이다
                - 비트 수가 제한된지 않고 메모리 한계까지 확장할 수 있다
            - bool 

    - ***numbers.Real(float)***
        - 부동 소수점 수를 나타낸다
        - 소수점이하 15자리까지 정확하게 구현한다
        - 정수와 부동소수점(예/2.e2)은 소수점으로 구분된다(정수: 1, 부동소수점: 1.0)

    - ***numbers.Complex(complex)***
        - 복소수를 나타낸다

- ### ***시퀀스(sequence)***
    - 인덱싱(indexing)될 수 있는 유한한 길이의 순서 있는 자료형들
    - 불변(immutable) 시퀀스
        - 문자열(Strings)  
            - 유니코드(U+0000 - U+10FFFF) 범위의 모든 코드 포인트들은 문자열로 표현될 수 있다
            - 파이썬에는 char 형이 없다
        - 튜플(Tuples)
        - 바이트열(Bytes)
            -  8-비트 바이트인데, 0 <= x < 256 범위의 정수로 표현된다
            - 바이트 객체를 만들 때는 바이트열 리터럴(b'abc' 와 같은) 과 내장 bytes() 생성자를 사용할 수 있다
    - 가변(mutable) 시퀀스
        - 리스트(List)
        - 바이트 배열(Byte Arrays)
            - 내장 bytearray() 생성자로 만들어집니다
- ### ***집합형(Set types)***
    - 중복 없는 불변 객체들의 정렬되지 않는 자료형
    - 인덱싱 할 수 없다, 이터레이션은 가능하다
    - 내장 집합형
        - 집합(Sets)
            - 가변 집합이다
            - set()으로 생성할 수 있다
        - 불변 집합(Frozenset)
            - frozenset()으로 불변집합을 선언할 수 있다(해시가능)
- ### ***매핑(Mappings)***
    - 인덱스 집합으로 인덱싱되는 객체들의 유한한 자료형
    - 사전(Dictionaries)
        - 리스트, 사전, id가 아닌 값으로 비교되는 것들은 키로 사용할 수 없다
        - 삽입 순서를 유지한다
        - 가변형 이다

- ### ***Callable types***
    - 함수 호출 연산(```__call__```)이 적용될 수 있는 자료형들

    - ### ***인스턴스 메서드(Instance methods)***
        - 클래스와 클래스객체, 모든 callable객체(사용자정의 함수)를 결합한다
        - ```__self__``` 어트리뷰트는 클래스 자신이고, ```__func__``` 어트리뷰트는 클래스 메서드가 기반을 두는 함수 객체입니다.

    - ### ***제너레이터 함수(Generator functions)***
        - yield문을 사용하는 함수나 메서드를 제너레이터 함수라고 한다
        - 이터레이터 객체를 돌려준다
        - ```__next__```() 메서드로 다음 이터레이션 값을 얻는다
        - 끝에 도달하면 StopIteration 예외를 일으키고 종료된다

    - ### ***코루틴 함수(Coroutine functions)***
        - async def 를 사용해서 정의되는 함수나 메서드이다
        - 해당 함수를 반환하면 코루틴 객체를 반환 한다
        - await 표현식, async with, async for 문등 사용가능

    - ### ***비동기 제너레이트 함수(Asynchronous generator functions)***
        - async def를 사용해서 정의 된 함수가 yield문을 사용하면 비동기 제너레이터 함수라고 한다
        - 비동기 이터레이터 객체를 반환하고 async for문에서 사용된다
        - 비동기 이터레이터의 aiterator.```__anext__```() 메서드를 호출하면 어웨이터블을 반환한다
        - await 할 때 yield문이 값을 반환할 때까지 함수가 실행된다

    - ### ***내장 함수(Built-in functions)***
        - 내장 함수 객체는 C 함수를 둘러싸고 있다(wrapper)

    - ### ***내장 메서드(Built-in methods)***
        - 내장 함수의 다른 형태이다
        - 묵시적인 추가의 인자(self,cls)로 C 함수에 전달되는 객체를 갖고 있다

    - ### ***클래스(Classes)***
        - 클래스는 callable이다
        - 자신의 새로운 인스턴스를 만드는 팩토리로 동작
        - 호출 인자는 ```__new__```() 로 전달되고, 일반적으로, 새 인스턴스를 초기화하기 위해 ```__init__```() 로도 전달된다

    - ### ***클래스 인스턴스(Class Intances)***
        - 클래스에서 ```__call__```() 메서드를 정의함으로, 클래스 인스턴스를 콜러블로 만들 수 있다

- ### ***모듈(Modules)***
    - 파이썬 코드의 기본적이 조직화 단위
    - 모듈 객체는 딕셔너리 객체로 구현되는 이름 공간을 갖는다 (m.x 는 m.```__dict__```["x"] 와 같다.)
    - 모듈을 초기화 하면 코드객체를 갖고 있지않는다, 어트리뷰트는 모듈의 이름공간 딕셔너리에 저장하고 갱신한다

- ### ***사용자 정의 클래스(Custom classses)***
    - 클래스는 딕셔너리로 구현된 이름 공간을 갖는다
    - 속성값에 대한 참조는 이 사전에 대한 참조로 변환된다

- ### ***클래스 인스턴스(Class instances)***
    - 클래스 객체를 호출해서 만들어진다
    - 사전형으로 구현되는 이름 공간에 속성 값들을 저장하고 검색한다

- ### ***I/O 객체(파일 객체)***
    - 파일 객체는 열린 파일을 의미한다
    -  open() 내장 함수, os.popen(), os.fdopen() 과 소켓 객체의 makefile() 메서드 등으로 생성할 수 있다

- ### ***내부 형(Internal types)***
    - 인터프리터가 내부적으로 사용하는 형으로 몇몇형은 사용자에게 노출한다
    - ### ***코드 객체(Code objects)***
        - 바이트로 컴파일된(byte-compiled) 실행 가능한 파이썬 코드를 의미, 바이트 코드라고 부른다
        - 함수 객체와는 다른 개념이다
        - 불변객체이고 가변객체들에 대한 어떤 참조도 없다
        - 특수 읽기 전용 속성(co_name, co_argcount....)

    - ### ***프레임 객체(Frame objects)***
        - 프레임 객체는 실행 프레임(execution frame)을 나타낸다
        - 트레이스 백 객체에 등장하거나 등록된 추적 함수로 전달될 수 있다
        - 특수 읽기 전용 속성(f_back, f_locals,..)
        - 특수 쓰기 가능 속성(f_trace)
        - 메서드(frame.clear())
    - ### ***트레이스백 객체(Traceback objects)***
        - 예외의 스택 트레이스를 나타낸다
        - 예외가 발생할 때 만들어지고 명시적으로 만들 수도 있다
        - 특수 읽기 전용 속성(tb_frame,tb_lineno..)
        - 특수 쓰기 가능 속성(tb_next)
    
    - ### ***슬라이스 객체(Slice objects)***
        - ```__getitem__```() 메서드를 위한 슬라이스를 나타낸다
        - slice()로 생성 할 수 있다
        - 특수 읽기 전용 속성(start, stop, step)
        - 메서드(slice.indices(self, length))

    - ### ***스태틱 메서드 객체(Static method objects)***
        - 함수 객체를 메서드 객체로 변환하는 방법을 제공한다
        - 객체를 wrapping한다
    
    - ### ***클래스 메소드 객체(Class method objects)***
        - 객체를 wrapping해서 호출하는 방식에 영향을 준다

## 3. 특수 메서드 이름들
# 
- 클래스는 특별한 이름의 메서드들을 정의함으로써 특별한 문법에 의해 시작되는 어떤 연산들을 구현할 수 있다.

- ***연산자 오버 로딩 (operator overloading)에 대한 파이썬의 접근법***으로 x가 클래스의 인스턴스일때 , x(i)는 type(x).메서드(x, i)와 동등하다
# 
### 1. 기본적인 커스터마이제이션
- ***object.```__new__```(cls[,...])***
    - 클래스 cls(자기자신)의 새 인스턴스를 만들기 위해 호출된다
    - ```__new__```() 는 스태틱 메서드이다
    - 첫번째 인자로 클래스를 받고 나머지 인자들은 클래스 호출의 인수값들을 받는다
    - 인자로 클래스를 받지 않으면 ```__init__```()은 호출되지 않는다
    - 클래스의 인스턴스를 반환한다
    - 인스턴스 생성을 커스터마이즈 할수 있다

- ***object.```__init__```(self[,...])***
    - ```__new__```()가 객체를 생성하고, ```__init__```()으로 커스터마이징한다
    - init에서 None 이외의 값이 return되면 TypeError가 발생한다

- ***object.```__del__```(self)***
    - 인스턴스가 삭제되기 직전에 호출 된다.
    - del x는 x의 참조횟수를 하나 감소시키고 x.```__del__```()은 참조횟수가 0이 될때 호출 된다
    - 따라서 객체를 지우려면 참조하는 값이 없어야 한다

- ***object.```__repr__```(self)***
    - repr() 내장 함수에 의해 호출되서 객체의 형식적 문자열 표현을 계산한다
    - 디버깅에 사용되기 때문에, 표현이 풍부한 정보를 담고 애매하지 않아야 한다
- ***object.```__str__```(self)***
    - str(obj),format(), print() 에 의해 호출되어서 비형식적인 또는 보기좋은 문자열 표현을 반환한다

- ***object.```__bytes__```(self)***
    - bytes 에 의해 호출 되어 객체의 바이트열 표현을 연산한다. 
    - bytes 객체를 반환한다

- ***object.```__format__```(self,format_spec)***
    - format(), 포맷 문자열 리터럴(f"{}"), str.format() 메서드로 호출 된다
    - 문자열이 반환된다

- ***비교메서드(comparison method)***
    - .```__lt__```(self, other)  -> x < y
    - .```__le__```(~~,~~)  -> x <= y
    - .```__eq__```(~~,~~)  -> x == y
    - .```__ne__```(~~,~~)  -> x != y
    - .```__gt__```(~~,~~)  -> x > y
    - .```__ge__```(~~,~~)  -> x >= y
    - x compar y 는 x.```__compar__```(y) 와 같다
    - 불리언 값을 반환한다.

- ***object.```__hash__```(self)***
    - hash()와 set, frozenset, dict와 같은 해시형 컬렉션 멤버에 대한 연산에서 호출 된다
    - 정수값을 반환한다
    - ```__eq__```()를 재정의 했을때 클래스가 불변형을 정의하는경우 ```__hash__```()도 재정의해야 해시를 사용할 수 있다
    - ```__eq__```()를 재정의하고 ```__hash__```()를 정의하지않으면 ```__hash__```()는 None으로 설정되고 해시값을 얻으려 할때 TypeError를 반환한다.

- ***object.```__bool__```(self)***
    - 논리값 검사와 bool() 구현을 위해 호출 된다
    - False, True를 반환한다
    - ```__len__```()이 호출되어 값이 0이 아니면 참으로 인식한다
    - 클래스가 ```__len__```(), ```__bool__```()을 정의하지않으면 모든 인스턴스는 참으로  취급된다

2. ### 속성 엑세스 커스터마이제이션
- ***object.```__getattr__```(self,name)***
    - getattr() 메서드가 __```getattribute__```를 호출해서 속성 값이 존재하지 않을때 호출되서 AttributeError예외를 일으킨다

- ***object.```__getattribute__```(self, name)***
    - getattr(인스턴스, '속성', 디폴트) 메서드로 호출 되서 속성 값을 반환한다

- ***object.```__settattr__```(self, name, value)***
    - setattr(object, attribute_name, value)메서드로 속성을 추가할 때 호출 된다. 

- ***object.```__delattr__```(self. name)***
    - delattr(obj, name) 메서드로 속성을 삭제할 때 호출된다

- ***object.```__dir__```(self)***
    - dir()이 메서드로 호출된다
    - 포함하고 있는 매직 메서드를 리스트로 변환후 정렬한다

### 3.1 디스크립터(descriptor) 구현
- ***디스크립터란***
    - "```__get__, __set__ 또는 __delete__``` 스페셜 메소드 중 한개 이상 구현 되어 있는 객체"
    - ```__get__```만 있으면 비 데이터 디스크립터이다
    - ```__set__ 또는 __delete__```이 같이 있으면 데이터 디스크립터이다

- ***object.```__get__```(self, instance, owner=None)***
    - 소유자 클래스속성(디스크립터인스턴스)이나 그 클래스의 인스턴스의 속성에 접근할때 호출된다
    - owner 는 소유자 클래스이다. 
    - 계산된 속성값을 반환하거나 AttributeError예외를 일으킨다

- ***object.```__set__```(self, instance, value)***
    - 소유자인 클래스의 인스턴스 속성값을 새 값(value)로 설정할 때 호출된다

- ***object```__delete__```(self, instance)***
    - 소유자인 클래스의 인스턴스 속성값을 삭제할 때 호출 된다

### 3.2 디스크립터(descriptor) 호출
