- 라우터 : IP주소를 확인하고 자신이 가진 경로 정보를 지정해주는 장비
    - L3스위치는 하드웨어로 구현한 형태로 패킷을 빨리보내는게 목적이었지만 기술의 발달로 라우터와 경계가 거의 없어 졌다

## 라우터의 동작 방식과 역할
- 경로 지정 
    - IP의 네트워크 주소를 기반으로 최적의 경로를 라우팅 테이블에 저장한다


- 브로드캐스트/멀티캐스트 컨트롤
    - 멀티 케스트정보를 습득하지 않고 브로드캐스트 패킷을 전달하지 않는다
        - 스위치와 반대로 들어온 패킷에 목적지 주소가 테이블에 없으면 패킷을 버린다
        - 플러딩이 다른 네트워크로 전파되는 것을 막을 수 있다


- 프로토콜 변환 : 포워딩에서 2계층 헤더를 지우고 새로운 2계층 헤더를 만든다 
    - 서로 다른 프로토콜로 구성된 네트워크를 연결할 수 있도록 한다

- 라우터의 역할 
    1. 경로 정보 얻기
    2. 해당 경로로 패킷을 포워딩하기

## 경로 지정 - 라우팅/스위칭
- 서머리(Summary) 
    - 라우팅 정보 최적화를 위해 서브넷 정보를 묶는다

- 라우팅 동작과 라우팅 테이블
    - ***Hop-by-Hop : 네트워크를 한단계씩 뛰어넘는다는 의미***
        - 인접한 라우터까지로만 경로를 지정하면 최적의 경로를 다시 파악해서 포워딩한다

    - Next Hop(인접 라우터)지정
        - 다음 라우터의 IP를 지정하는 방법(일반적)
        - 라우터의 나가는 로컬 인터페이스(예:이더넷포트) 지정하는 방법
            - IP주소를 모르고 MAC주소를 알아낼수 있을 때 사용
        - 둘을 동시에 지정하는 방법
            - VLAN같은 논리적 인터페이스를 사용할 수 있게 된다
        
        - 라우터는 패킷을 목적지 정보만 사용해서 넥스트 홉으로 포워딩한다
            - PBR(Policy-Based Routing)
                - 출발지 주소를 이용해 라우팅하는 기술
                - 관리나 장애해결이 어려워서 특별한 목적으로만 사용됨

    - 라우팅 테이블데이터
        - 목적지 주소
        - 넥스트 홉 IP주소, 나가는 로컬인터페이스(선택가능)

- 루프가 없는(Loop Free) 3계층 : TTL(Time To Live)
    - 패킷이 네트워크에 살아 있는 시간(홉)값을 제한해서 라우팅 루프를 방지한다
        - 홉을 지날때마다 1씩 감소한다
    - 라우팅 루프 : 라우터가 서로에게 패킷을 반복해서 포워딩하게 되는 것

- ***라우팅(라우터가 경로 정보를 얻는 방법)***
    - 다이렉트 커넥티드(Direct Connected)
        - IP주소의 네트워크 주소로 경로를 얻는 방법
        - 로컬 인터페이스로 연결된 IP의 경로를 자동으로 생성된다

    - 스태틱 라우팅
        - 관리자가 목적지 네트워크와 넥스트 홉을 라우터에 직접 지정해 경로 정보를 입력하는 것
        - 목적지로 향하는 경로와 돌아오는 경로를 각 라우터에 지정해야 한다
        - 규모가 있는 네트워크를 관리하기는 어렵다
            - 장애발생시 대체경로로 패킷을 보낼 수 없다

    - 다이나믹 라우팅(일반적)
        - 라우터끼리 자신이 알고있는 경로, 링크 상태 정보를 교환해 전체 네트워크 정보를 학습한다
            - 정보가 변경되거나 장애발생시 대체 경로로 포워딩 할수 있다

        - 교환할 네트워크를 선언해줘야 한다
    
    - 경로를 얻으면 최선의 경로를 찾아서 별도 테이블에 미리 보관한다
        - 토폴로지 테이블 : 라우터가 수집한 경로정보, 원시데이터
        - 라우팅 테이블 : 토폴로지 테이블에서 최적의 경로를 저장
    
- ***스위칭(라우터가 경로를 지정하는 방법)***
    - 라우팅 테이블을 참조해서 최적의 경로로 패킷을 외부로 포워딩하는 작업
        - 롱기스트 프리픽스 매치(Longest Prefix Match)
            - 라우팅 테이블에 일치하는 정보가 없어도 가장 가까운 경로를 선택한다
                - 많은 리소스를 소모한다
            
            - 리소스를 줄이기 위해 한번 처리한 스위칭을 캐시에 저장한다
                - 라우팅 테이블보다 캐시를 먼저확인한다

- ***라우팅, 스위칭 우선순위***
    - 인접 라우터들에 목적지 네트워크가 복수로 연결되어있으면 가중치 값으로 우선순위를 정한다

    - 우선순위(AD, Administrative Distance(관리 거리))
        1. 다이렉트 커넥티드
        2. 스태틱 라우팅
        3. 다이나믹 라우팅
        - 관리자가 우선순위를 설정할 수 있다
    - 관리거리가 같으면 코스트 값(거리)으로 우선순위를 정한다
        - 코스트 값이 같으면 ECMP(Equal-Cost Multi-Path)기능으로 경로 값 정보를 모두 활용해 트래픽을 분산한다
    
    - **라우팅,스위칭 우선순위**
        1. 롱기스트 매치(가장 유사한 경로)
        2. 관리 거리(우선순위가 높은 경로)
        3. 코스트(거리가 가까운 경로)
        4. 부하분산ECMP(트래픽분산)
    
## 라우팅 설정 방법
- 다이렉트 커넥티드
    - 다이렉트 커넥티드인 경로는 L2통신으로 패킷을 전달한다 
    - 외부 네트워크가 다이렉트 커넥티드 경로인 경우 통신이 불가능하다
    
- 스태틱 라우팅
    - 라우팅 설정 문법
        - 네트워크장비(시스코) : ip route NETWORK NETMAST NEXTHTOP
        - 리눅스 서버 : route add -net NETWORK /Prefix gw NEXTHOP
        
    - 인터넷에는 840,000개 이상의 라우팅 정보가 있고 이런 정보를 처리하는 대용량 라우터는 인터넷 사업자가 운영한다

    - ***디폴트 라우팅 : 목적지 주소의 서브넷 마스크가 0.0.0.0 인 스태틱 라우팅***
        - 0=네트워크를 체크하지않는다 -> 0.0.0.0=모든 네트워크 허용
        - 마지막 대체 경로로 사용된다
        - 서버에 디폴트 게이트웨이를 설정하면 서버에 라우팅 테이블에 디폴트 라우팅이 생성된다
    
- 다이나믹 라우팅
    - 스태틱은 통신의 경로에 있는 모든 라우터에 넥스트 홉을 지정해줘야 한다
        - 관리하기 어렵고 대체 경로 설정이 복잡해 진다
        - 다이나믹 라우팅은 경로정보를 수집하고 전달해서 관리가 쉽고 대체경로를 자동으로 설정한다
    
- ***다이나믹 라우팅 프로토콜***
    - OSPF, BGP프로토콜이 주로 사용된다
    - 유니캐스트 경로 정보를 교환하는 프로토콜(일반적) 
        - RIP, IGRP, OSPF, IS-IS, EIGRP, BGP

    - 멀티캐스트 경로 정보를 교환하는 프로토콜
        - DVMRP, MOSPF, PIM

    - 역할에 따른 분류
        - AS(Autonomous System)    
            - 하나의 조직, 내부적으로 자체적인 규칙을 세워 운영한다
                - 정책적으로 AS의 통신을 막을 수도 있다
            - 인터넷의 자율시스템, 인터넷 사업자가 운영한다
                - 사업자 간에 이해관계에 따라 연결 경로가 달라지므로 특정 서버로 통신이 빠르거나 느린 차이가 생길 수 있다

        - IGP(Interior Gateway Protocol) 
            - AS내부에서 사용되는 라우팅 프로토콜
            
        - EGP(Exterior Gateway Protocol) 
            - AS간 통신에 사용하는 라우팅 프로토콜 
            
    - 동작 원리에 따른 분류
        - IGP
            - 디스턴스 벡터(Distance Vector) 
                - 인접한 라우터에서 경로 정보를 습득하는 라우팅 프로토콜(RIP, BGP)
                - 라우팅 정보 처리에 많은 리소스가 필요없어서 간단한 네트워크 구축에 사용된다
                - 모든 라우터 정보가 동기화 되는데 많은 시간이 필요하다
                    - 변경이 오래걸린다

            - 어드밴스드 디스턴스 벡터(Advanced Distance Vector)
                - 디스턴스 벡터를 보완한 프로토콜, 많이 쓰이지 않는다(IGRP, EIGRP)

            - 링크 스테이트(Link-State)
                - 라우터에 연결된 링크 상태를 서로 교환하고 각 네트워크 맵을 그리는 라우팅 프로토콜(OSPF, IS-IS)
                    - 링크로 토폴로지 데이터베이스를 만들고 SPF(Shortest Path First)알고리즘을 이용해 최단경로 트리를 만든다
                
                - 전체 네트워크 맵, 경로 변화를 파악하기 쉽지만 부하로 작용할 수 있다
                    - 최적화를 위해 네트워크를 AREA단위로 분리하고 단위내에서만 링크를 교환한다
                    - AREA외부 라우터는 가공된 라우팅 테이블 형태로 정보를 전달한다
                
                - Backbone AREA 
                    - AREA0으로 중심이 되서 모든 AREA를 연결한다
                - ABR(Area Border Router) 
                    - Backbone AREA와 다른 AREA를 연결해주는 경계 라우터
                - ASBR(Autonomous System Border Router)
                    - OSPF가 아닌 다른 외부의 정보를 연결시켜주는 외곽 라우터 

    - 다이나믹 라우팅 활용 현황
        - RIP는 소형 네트워크에서 많이 사용됬지만 여러 제약 때문에 사용되지 않는 추세이다
        - EIGRP는 한때 유행했지만 특정 회사가 개발해서 다른 회사장비에서는 사용할 수 없어서 대부분 사라졌다
        - BGP는 다양한 프로토콜과 호환되고 AS외부,내부에서 사용할 수 있어 많이 적용되고 있다