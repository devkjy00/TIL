## 보안의 개념과 정의
- 정보 보안의 정의
    - 필수요소 
        - 기밀성(Confidentiality) : 공개 범위 제한
        - 무결성(Integrity) : 완전한 정보 유지 
        - 가용성(Availability) : 접근 관리
    
    - 네트워크 정보 보안
        - 자료유출, 서비스 방해를 막는 것이 목표

- 네트워크 보안의 주요개념
    - Trust 네트워크 : 보호받아 할 네트워크
    - Untrust 네트워크 : 신뢰할 수 없는 외부 네트워크
    - DMZ(DeMilitarized Zone) 네트워크 : 신뢰할 수 없는 외부 사용자에게 개방해야 하는 서비스 네트워크

    - 네트워크 보안 분야
        - Internet Secure Gateweay
            - Trust, DMZ 에서 Untrust로의 통신을 통제
            - 패킷을 적절히 인식하고 필터링하는 기능 필요(SWG, 웹 필터, 애플리케이션 컨트롤, 샌드박스)
        
        - Data Center Secure Gateway
            - Untrust에서 Trust, DMZ로의 통신을 통제
            - 외부의 공격을 막기위한 공격관련 정보 필요(방화벽, IPS, DCSG, WAF, Anti-DDoS)

- 네트워크 보안 정책 수립에 따른 분류
    - 화이트리스트 : 신뢰할 수 있는 통신만 허용하는 방식

    - 블랙리스트 : 문제가 있었던 IP, 패킷 리스트를 기반으로 데이터베이스를 만들어서 방어하는 방식(공격 패턴)


- 정탐, 오탐, 미탐(탐지 에러 타입)
    - 오탐 : 정상 패킷을 공격으로 탐지하고 드롭
    - 미탐 : 공격 패킷을 정상으로 탐지하고 허용
    - 정탐 : 패킷을 올바르게 탐지하고 드롭/허용


## 보안 솔루션의 종류
- DDoS 방어 장비
    - DoS는 일반적으로 공격 출발지에서 직접 공격한다
        - 탐지가 쉽고 IP주소 기반으로 방어가능
        - 다수의 봇을 이용한 분산공격 DDoS가 등장
    
    - DDoS 방어 장비는 볼류메트릭 공격을 방어하기 위해 네트워크 내부와 외부의 경계에 위치한다
        - 볼류메트릭(Volumetric) 공격 : 회선 사용량, 트래픽을 과도하게 발생시켜 사용을 방해하는 공격

- 방화벽
    - 4계층에서 동작하는 패킷 필터링 장비 
        - 3/4계층 정보를 기반으로 정책을 세워 패킷을 허용/거부 한다
    
- IDS(Instrusion Detectino System), IPS(Intrusion Prevention System)
    - 방화벽에서 방어할 수 없는 다양한 어플리케이션 공격을 방어하는 장비
    - 제조사나 서비스 업체로부터 공격 데이터베이스를 제공받아서 패킷을 검사한다

- WAF(Web Application Firewall)
    - HTTP, HTTPS처럼 웹 서버에서 동작하는 웹 프로토콜의 공격을 방어하는 장비
        - IPS에서 방어할 수 없는 IPS회피 공격을 방어할 수 있다
    
    - 프록시 서버처럼 패킷을 데이터 형태로 조합해 처리한다
        - 데이터를 추가/수정할 수 있다

- 샌드박스
    - APT(Advanced Persistent Threat), ATA(Advanced Target Attack)
        - 악성코드를 다운받도록 속여서 PC를 감염시키는 방법
        - C&C(Command&Control) 서버 : 악성코드로 감염된 PC와 연결된 서버
            - 방화벽에서는 정상적인 통신으로 보여서 방어하기 어렵다
        
    - 샌드박스는 APT의 공격을 방어하는 대표적인 장비이다
        - 가상 운영체제 안에서 파일을 직접 실행시켜서 모니터링하고 악성코드 여부를 판별한다
    
- NAC(Network Access Control)
    - 네트워크에 접속하는 장치들을 제어하는 장비
    - 인가된 사용자만 내부망에 접속할 수 있다

- IP제어
    - IP를 할당하고 인증된 IP가 아니면 네트워크 접속을 막는 기능
        - NAC와 공통적인 기술이지만 다른 목적으로 개발되었다
    
- 접근 통제
    - 서버, 데이터베이스에 대한 직접적인 접근을 막고 작업 추적 및 검사를 하는 접근 통제 솔루션
    - 배스천 호스트기반으로 가장 많이 구현된다
        - 서버에서 배스천 호스트를 통해서온 통신만 허용한다
    
- VPN
    - IPSEC, SSL이 가장 많이 쓰인다

    
## 방화벽
- 방화벽의 정의
    - 네트워크 3,4계층에서 동작
    - 세션을 인지하는 상태기반엔진(Stateful Packet Inspection, SPI)로 동작한다

- 초기 방화벽
    - 패킷 필터(Packet Filter), 스테이트리스(Stateless)
        - SPI엔진이 없어서 패킷의 인과 관계(세션)을 인지하지 못해서 정책(5-튜플)만으로 단순히 패킷을 필터링했다
            - 핸드셰이크의 요청과 응답과정에서 응답 패킷에 대한 정책이 없어서 모든 패킷을 허용해야 통신할 수 있었다
        - 5-tuple : source IP, Dest IP, Protocol No, Source Port, Dest Port
    
    - 문제점 
        - 불특정 다수 기반의 정책을 정의할 때 보안이 약화되는 문제가 있다
        - 5-튜플 외에 3,4계층 헤더를 변조해 공격하면 방어가 불가능하다
    
- 현대적 방화벽(SPI)
    - 상태 기반 방화벽(Stateful Inspection Firewall) : 세션 기반으로 동작하는 SPI엔진으로 동작한다
        - 패킷의 양방향 통신을 이해해서 요청에 응답하는 통신을 허용할 수 있다
    
- 방화벽 동작 방식
    - 방화벽 제조사별로 동작방식이 다양해서 제조사가 제공하는 Packet Processing Flow 문서를 확인해야 한다
    - *패킷 처리 순서*
        - 세션 상태 테이블 확인
            - 없으면 방화벽 정책 확인
                - 없으면 암시적 거부(Implicit Denial)규칙을 참고해 차단된다
                - 허용 규칙이 있으면 세션테이블에 저장한다
            
        - 세션 정보를 찾으면 포워딩 테이블을 확인한다(라우팅, ARP포함)
            - 있으면 적절한 인터페이스로 패킷을 포워딩
            - 없으면 패킷 폐기
        
    
    - OSI 3,4 계층의 세부적 필드도 같이 확인한다
        - TCP컨트롤 플래그로 동작 방식이 변하거나 시퀀스와 ACK 번호가 갑자기 변경되는 것을 인지해 세션 탈취 공격을 일부 방어할 수 있다
        - 세션을 로깅하기 쉽다
    
- ALG(Application Layer Gateway)
    - FTP같은 오래된 프로토콜은 방화벽과 호환되지 않는다
        - FTP 액티브 모드는 데이터 프로토콜과 컨트롤 프로토콜이 반대로 세션을 맺어서 방화벽이 이해하지 못한다
    
    - ALG : 애플리케이션 프로토콜을 확인하고 필요에 따라 세션을 인지해서 포트를 자동으로 열어준다  
        - PAT기능이 동작하는 방화벽에서 PAT를 정상적으로 통과하지 못하는 프로토콜을 인지해 세션 테이블을 만들어준다
    
- 방화벽의 한계
    - 상태 기반 방화벽으로 인해 새로운 공격 방식이 생겨났다
        - 공격 목표가 시스템이나 계정탈취에서 서비스 중단 쪽으로 바뀌고 DDoS공격이 새로운 트렌드가 되었다
    
    - 방화벽은 3,4계층의 정보만 인지하는 한계가 있다
        - 백도어나 인터넷 웜, 취약점 공격등을 방어할 수는 없다
            - 웜 공격을 막기위해 IPS가 등장했다
        
- *현대 방화벽 NGFW, UTM*
    - 상태 기반 방화벽은 레거시 방화벽이라고 한다
    - Next Generation Firewall, Unified Threat Management Firewall
        - 방화벽을 애플리케이션 영역까지 확장한 보안 장비이다

- *NFV(Network Function Virtualization)*
    - 네트워크 컴포넌트를 가상화해 범용 하드웨어에 적용하는 기술
        - 성능에 한계가 있지만 새로운 서비스를 추가, 삭제, 적용할 수 있다
    
    
## IPS, IDS
- 방화벽은 3,4계층 방어만 가능하고 애플리케이션 계층은 방어할 수 없고 이런 공격을 방어하기 위해 IDS, IPS가 개발되었다

- 정의
    - Intrusion Detection System(침입 탐지 시스템)
        - 시스템 해킹 '탐지'를 목적으로 개발된 시스템 
        - 트래픽을 복제해 검토하고 침입 여부를 판별한다
            - 공격을 탐지하면 알람을 보낸다
        
    - Intrusion Prevention System(침임 방지 시스템)
        - 시스템 해킹을 직접 차단하는 기능을 갖춘 시스템
        - 트래픽이 지나가는 인라인(Inline)상에 위치해서 트래픽을 검토한다
            - 유해 트래픽 차단/방어, 회피 공격을 차단을 위해 세션을 이해하고 능동적 방어를 위한 어노말리(Anomaly)등의 기능을 가진다
        
        - 최근에 도입되는 솔루션은 대부분 IPS이다
        - 구분
            - HIPS(Host based IPS)
            - NIPS(Network based IPS)
                - 일반적인 IPS 
    
- IPS 동작방식
    - 패턴 매칭 방식
        - 패턴/시그니처(Signature)/데이터베이스 방식 방어 
            - 공격 방식에 대한 데이터베이스를 최신으로 유지, 공격을 파악하는 기술

        - 패턴 기반방어는 약간의 변화만 생겨도 적절한 대응이 어렵다
            - 블랙리스트 기반의 방어 방식의 한계

    - 어노말리 공격 방어
        - 화이트리스트 기반의 방어 기법으로 공격으로 파악되지 않아도 기준을 넘는 행동을 하면 방어한다

        - 프로파일 어노말리(Profile Anomaly)
            - 관리자가 정해놓은 기준이나 IPS장비가 모니터링해 정해진 기준과 다른 값을 공격으로 판단한다
                - 기준값보다 많은 트래픽이 발생하는 경우..
                - 동적 프로파일 기능의 강화로 DDoS방어 장비로 진화한다

        - 프로토콜 어노말리(Protocol Anomaly)
            - 악성 코드에 감염된 좀비 PC를 탐지하는 기법
                - 이런 공격은 잘 알려진 서비스 포트를 사용하지만 해당 포트에 일반적이지 않은 프로토콜을 사용해서 공격으로 의심하고 적절히 제어한다
            

- 한계와 극복(NGIPS)
    - IPS는 플로 엔진을 사용해서 비교적 쉽게 우회할 수 있다
        - 플로(Flow) 엔진 : 패킷을 데이터 형태가 조합하지 않고 흘러가는 상황을 모니터링해 공격을 탐지
    
    - IPS는 오탑이 많아서 튜닝작업이나 최적화 작업을 해줘야한다
        - 설치만 하고 제대로 사용하지 못하는 경우가 많다
    
    - NGIPS(Next Generation IPS)
        - 애플리케이션을 인지, 다양한 시스템과 연동할 수 있다
        - APT공격을 방어하는 일부 기능 탑재
    
- *IPS가 공격 데이터베이스를 얻는 방법*
    - 새로운 공격을 탐지하기 위해 인터넷에 허니팟(Honeypot)시스템을 구축한다
        - 허니팟은 공격에 대한 방어가 없고 취약점이 많아서 해커가 공격 대상으로 생각하고 공격한다
        - 공격을 로깅하고 분석해 데이터베이스로 바꾸는 작업을 돕는다

## DDoS 방어장비
- 정의
    - 단순한 서버 공격에서 인프라 기반 서비스 영역까지 공격이 확대 되었다
        - 제조업체들의 보안 패치 대응으로 DDoS공격 형태도 다양해졌다
        - DDoS 방어에 전문적인 장비가 등장하게 되었다
    
- 동작 방식
    - 클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방어 장비를 사내에 설치하는 방법이 있다
    - 방어 기법
        - 인라인
            - 탐지와 방어를 한 장비에서 수행
        - 아웃 오브 패스
            - 탐지와 방어를 구분해서 다른 장비에서 수행
            - DDoS는 대규모 공격이라서 아웃 오브 패스가 일반적이다

        - 공격 IP리스트를 탐지해서 IP를 버리는 방법이 가장 흔한 방어 기법이다

        - 프로파일링 기법 : 일반적인 대역폭, 세션량, 초기 접속량등을 저장, 과도한 트래픽은 알려주고 차단한다
        
        - 보안데이터베이스 기반 방어 : IP평판 데이터베이스를 공유해 DDoS공격으로 사용된 IP에 대해 정책대로 처리한다
    
- DDoS 공격 타입
    - 볼류메트릭 공격
        - 대용량 트래픽을 발생시켜 대역폭을 포화시킨다    
            - 증폭 기술로 생성하기 쉽다
        - 최종 자원(서비스)에 대한 엑세스를 완전히 차단할 수 있다
            - NTP 증폭, DNS 증폭, UDP 플러드, TCP 플러드
            
    - 프로토콜 공격
        - 3, 4계층 프로토콜 스택의 취약점을 악용해 대상에 엑세스할 수 있게 만드는 공격
        - 공격 대상이나 중간 위험 리소스의 처리 용량을 모두 사용해 서비스 중단을 유발
            - 네트워크 보안 장비를 대상으로 하는 경우가 많다
            - Syn 플러드, Ping of Death
        
    - 애플리케이션 공격
        - 7계층 프로토콜 스택의 약점을 악용, 가장 정교하고 까다로운 공격
        - 대상과의 연결을 설정한 후 프로세스와 트랜잭션을 독점해 서버 자원을 소모시킨다
            - 애플리케이션 프로토콜이나 서비스제공 플랫폼의 취약점을 악용하는 경우가 많다
            - HTTP 플러드, DNS 서비스 공격, Slowloris등

    
- 볼류메트릭 공격 
    - DDoS 장비는 주로 볼류메트릭 공격, 프로토콜 공격을 방어하는데 사용된다
    - 좀비 PC를 이용한 공격
        - 특정 시간에 특정 타깃을 공격하는 형태로 발생
    
    - 증폭 공격(Amplification Attack)
        - 공격자가 공격대상을 출발지로 설정하고 중간 리플렉터들에 요청을 보내면 많은 리플렉터가 한번에 공격대상으로 응답을 보내면서 수백 배의 공격 트래픽을 발생 시킨다
    
    - 혼자서는 대부분 방어가 불가능해서 ISP를 통한 방어나 Cloud DDoS 솔루션을 통해 트래픽이 도달하지 못하도록 조치해야 한다
        - 볼류메트릭 공격은 회선 사업자 차원에서 미리 방어되어야 해서 서비스 가입이나 사업자의 도움이 별도록 필요하다
        - 클라우드 기반 서비스는 실제 서비스 네트워크가 가려져서 큰 투자 없이 방어할 수 있다

## VPN(Virtual Private Network)
- 물리적으로 전용선이 아닌 공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술
    - 주로 공중망을 전용선과 같은 사설망처럼 사용하기 위해 도입해서 보안을 제공해야 한다(IPSEC, SSL)
        - 네트워크 대 네트워크 연결에는 IPSEC VPN기술이 사용된다 
            - 양 쪽 네트워크 장비에서 IPSEC VPN기능을 지원하는 장비가 필요하다

        - 개인 사용자가 네트워크에 접속하는 경우 SSL VPN기술이 사용된다
            - 네트워크쪽에 SSLVPN장비가 있으면 사용자는 별도의 장비가 없어도 된다

- VPN 동작 방식
    - 터널링 기법 : 패킷을 터널링 프로토콜로 감싸서 통신하는 기법
        - 패킷을 암호화하거나 인증, 무결성 체크등의 보안 기능을 통해서 패킷이 노출되어도 감청하지 못하도록 보호할 수 있다

    - VPN의 형태
        - Host to Host 통신 보호
            - 두 호스트 간에 직접 VPN터널을 연동
            - 잘 사용되지 않는다

        - Network to Network 통신 보호
            - IPSEC 프로토콜 스택이 가장 많이 사용된다

        - Host가 Network로 접근할 때 보호
            - IPSEC과 SSL프로토콜이 범용적으로 쓰인다

- *전용 회선과 VPN*
    - 전용회선은 회선 자체네 데이터가 그대로 전달되고 암호화 되지 않는다
    - VPN를 추가해서 데이터를 암호화 하기도 한다

- *회피 공격*
    - 보안 장비에서 정상적인 통신으로 확인 되지만 실제로 공격이 타겟에게 도착하는 경우
        - 우회 기법은 보안 장비의 종류, 특정 회사의 특정 보안체계에 따라 달라진다
    
    - 피해자가 패킷과 데이터를 처리하는 방법과 보안 장비의 다른 부분을 집중 공격한다