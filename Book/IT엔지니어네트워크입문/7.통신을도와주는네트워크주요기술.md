## NAT/PAT
- NAT(Network Address Translation, 네트워크 주소 변환)
    - 1:1로 IP주소를 변환한다
        - 사설IP를 공인IP로 또는 반대로 전환(가장일반적)
        - 사설IP를 다른 사설IP로 공인IP도 동일하게 전환 할수 있다
    - PAT(Port Address Translation)
        - 여러개의 IP를 하나의 IP로 변환
    - AFT(Address Family Translation) 
        - IPv4주소를 IPv6주소로 또는 반대로 변환
    
- NAT/PAT의 용도와 필요성
    1. IPv4 주소 고갈문제의 솔루션으로 NAT가 사용된다
        - NAT을 통한 공인IP와 사설IP의 사용

    2. 보안을 강화하는 데 NAT 기술을 사용한다
        - 내부 IP를 다른 IP(사설)로 변환해 통신하면 외부에 사내IP주소 체계를 숨길 수 있다
    
    3. IP주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 해준다
        - 두개의 로컬 네트워크를 합칠 때 사설IP가 충돌할 수 있다 
        - 더블 넷(Double NAT)기술로 출발지와 도착지를 한꺼번에 변환할 수 있다
    
    4. 불필요한 설정 변경을 줄일 수 있다
        - NAP/PAT를 이용해 내부 네트워크를 구성하면 서버와 PC의 IP주소 변경없이 회선과 IDC 사업자 이전이 가능하다
    
    - 단점
        - NAT로 인해 주소가 변환되면서 단말 간 직접적인 연결성이 무너졌고 개발자들이 개발과정에서 NAT환경을 항상 고려해야하는 상황이 되었다
    
- NAT 동작 방식
    - 로컬 네트워크에서 웹 서버에 요청하기 위해서 출발지인 사설IP를 공인IP로 변경한다
        - 변경 전후의 IP주소는 NAT테이블에 저장된다
    
    - 요청을 받은 웹 서버는 응답을 보내고 도착지인 공인IP는 NAT장비에서 사설IP로 다시 변경된다

- PAT 동작 방식
    - 출발지 IP뿐 아니라 서비스 포트도 변경된다
        - 서비스 포트는 IP마다 다르게 적용되서 사용자를 구분할 수 있다
        - 서비스 포트의 개수는 제한이 있어 모두 사용중이면 정상적으로 동작하지 않는다
    
    - 웹 서버가 응답을 보내면 다시 원래 IP와 포트로 변경해서 전달한다
        - PAT IP가 목적지 일때는 해당 IP가 어느 IP에 바인딩 되있는지 확인할 수 없어서 외부에서는 통신을 요청할 수 없다
    
- SNAT와 DNAT
    - SNAT(Source NAT) : 출발지 주소를 변경하는 NAT
        - 사설에서 공인으로 통신 할 때 많이 사용된다
        - 공유기처럼 PAT를 사용하는 경우이다

    - DNAT(Desination NAT) : 도착지 주소를 변경하는 NAT
        - 로드 밸런서에서 많이 사용된다
        - 사용자가 VIP(Virtual IP)로 서비스를 요청, 로드 밸런서는 VIP를 로드 밸런싱될 서버의 실제 IP로 DNAT해서 내보낸다


- 동적 NAT와 정적 NAT
    - 정적 NAT : 출발지와 목적지의 IP를 미리매핑해 고정해놓은 NAT
        - 1:1
        - NAT테이블 사전 생성

    - 동적 NAT : 출발지나 목적지가 사전에 정해지지 않고 동적으로 변경하는 것 
        - 출발지나 목적지중 한곳이 다수의 IP로 구성된 IP pool이나 Range로 설정되어 있다
        - 1:N, N:1, N:M
        - NAT수행시 NAT테이블 생성

## DNS(Domain Name System )
- 네트워크 프로토콜
    - 데이터 프로토콜
        - 데이터 전달
    - 컨트롤 프로토콜
        - 통신을 제어(ARP, ICMP, DNS)

- DNS 
    - 도메인 주소를 IP주소로 변환하는 역할
        - 사용자에게 익숙하고 서버IP변경이 쉽다
    
    
    - 동작
        1. 도메인 주소로 서비스 요청
        2. DNS 서버로 해당 도메인에 대한 IP주소 질의
        3. 서비스의 IP주소를 받아서 통신


- 구조와 명명 규칙
    - 도메인은 계층구조로 주소를 효율적으로 탐색할 수 있다
        - '.'로 계층을 구분한다
        - 역트리 구조로 Third-Level.Second_Level.Top-Level로 주소를 찾는다
            - www.naver.com
            - com -> naver -> www 순서로 해석 

        - TLD(Top-Level Domain)
            - 최상위 도메인으로 IANA에서 구분한 6가지 유형으로 구분할 수 있다
                - Generic(gTLD)
                    - 특별한 제한 없이 일반적으로 사용되고 세글자 이상으로 구성된다
                    - com(일반기업), edu(4년제 이상 교육기관), gov(미국 연방정부기관), int(국제기구, 기관), net(네트워크 관련기관), org(비영리기관)

                - country-code(ccTLD)
                    - 국가 최상위 도메인, ISO 3166표준에 규정된 두 글자의 국가 코드를 사용(kr)
                    - ccTLD를 사용할 경우 Second-Level에 gTLD를 사용한다(co.kr)
                        - 우리나라는 gTLD를 두글자로 줄여서 사용한다

                - sponsored(sTLD)
                    - 특정 목적을 위한 스폰서를 두고 있는 최상위 도메인
                        - 스폰서(민족공동체, 전문가 집단, 지리적 위치등)
                    - aero, asia, edu, museum 등 

                - infrastructure
                    - 운용상 중요한 인프라 식별자 공간을 지원하기 위해 전용으로 사용되는 최상위 도메인
                    - arpa : 인터넷 안정성 유지를 위해 새로운 모든 인프라 하위 도메인이 배치될 도메인 공간 역할
                        - 리버스도메인에서 사용된다

                - generic-restricted(grTLD)
                    - 특정 충족하는 사람이나 단체가 사용할 수 있는 최상위 도메인
                    - biz, name, pro

                - test(tTLD)
                    - IDN(Internationallized Domain Names) 개발 프로세스에서 테스트 목적으로 사용한다
                    - test
        
    
        
    - 명명규칙
        - 최대 128계층 까지 구성 가능
        - 알파벳, 순자, "-"만 사용가능하고 대소문자 구분이 없다
    
    - 루트 도메인
        - 도메인을 구성하는 최상위 영역, 전 세계에 13개가 있다
            - DNS서버를 설치하면 루트 DNS의 IP주소를 기록한 루트 힌트 파일이 생성된다
            - 반복적 쿼리(Iterative Query)
                - DNS서버에 도메인의 정보가 없으면 루트 도메인을 관리하는 루트 DNS에 쿼리하게 된다
                - 루트 DNS는 TLD값을 확인해 담당 루트DNS가 어디인지 응답하고 서버는 해당 루트 DNS로 쿼리한다
        
- DNS 동작 방식
    - DNS서버에 쿼리하는 방법
        - 재귀적 쿼리(Recursive Query)
            - DNS 캐시를 먼저 확인하고 정보가 없으면 DNS서버에 쿼리한다
        - 동적 DNS캐시 : 응답받은 DNS의 IP주소를 캐시에 저장한다


    - 로컬에 도메인과 IP주소를 직접 설정하는 방법
        - hosts 파일 : 로컬에서 도메인과 IP를 관리하는 파일
        - 정적 DNS캐시 : hosts 파일의 도메인 리스트는 항상 DNS캐시에 저장된다
    
- 마스터와 슬레이브
    - DNS서버는 마스터(Primary)서버와 슬레이브(Secondary)서버로 나눌 수 있다
        - 마스터 서버
            - Zone 파일을 직접 생성, 관리
            - 미리 설정된 서버만 영역 전송이 가능하도록 제한할 수 있다

        - 슬레이브 서버
            - 영역 전송(Zone Transfer) : 마스터에 만들어진 Zone파일을 정기적으로 복제
    
    - 마스터 서버에 장애가 발생하면 만료시간(Expiry Time)후 슬레이브 서버도 동작하지 않는다
        - 만료시간 안에 마스터 서버를 복구하거나 슬레이브 서버를 마스터로 전환해야만 서비스 장애를 막을수 있다
    
    - *마스터와 슬레이브는 도메인별로 설정할 수 있지만 모든 도메인에 대해 동일하게 설정하는 것이 바람직한 방법이다*

- *액티브-스탠바이, 액티브-액티브*
    - 액티브-스탠바이 : 한쪽만 서비스를 제공, 한쪽은 대기
    - 액티브-액티브 : 양쪽모두 서비스를 제공
    - 한쪽에 장애가 발생해도 서비스가 지속되도록 고가용성(High Availability)기술을 제공한다

- DNS 주요 레코드
    - 종류
        - A(IPv4 호스트) : 도메인 주소를 IPv4로 매핑
            - 기본 레코드로 도메인 주소를 IP주소로 변환하는 레코드
            - IP와 도메인을 1:1로 매핑
            - 하나의 IP를 여러번 다른 도메인과 매핑하거나 반대로도 할 수 있다
                - 같은 IP라도 도메인 별로 HTTP헤더의 HOST필드에 도메인을 명시해서 웹 서버를 구분해 서비스 할 수 있다

        - AAAA(IPv6 호스트) : 도메인 주소를 IPv6로 매핑
            - 도메인 주소를 IPv6주소로 변환하는 레코드

        - CNAME(Canonical Name) : 도메인 주소에 대한 정식이름 
            - IP가 아닌 도메인 주소를 매핑한다
            - www.naver.com - naver.com
            - IP가 변경되면 CNAME은 도메인명을 매핑하기 때문에 도메인의 매핑만 변경하면 된다

        - SOA(Start Of Authority, 권한 시작) : 도메인 영역 대한 권한
            - 현재 네임서버가 해당 도메인 대한 관리 주체임을 의미
                - 다른 서버에 질의하지 않고 직접 응답한다

            - 도메인 영역 선언시 SOA레코드는 필수로 생성해야 한다
                - 만료시간, TTL, 관리자 도메인 관리에 필요한 값들을 설정

        - NS(Name Server) : 도메인에 대한 권한이 있는 네임 서버정보
            - 도메인의 권한을 가진 서버정보외에도 하위 도메인에 대한 권한을 다른 네임 서버로 위임하는 역할도 있다

        - MX(Mail eXchange) : 메일 서버를 구성할 때 사용되는 레코드
            - 도메인을 메일 주소로 같는 메일 서버를 선언
            - 우선순위가 높은 서버를 우선적으로 메일을 보낸다

        - PTR(Pointer) : IP주소를 도메인에 매핑(역방향)
            - 리버스도메인, 하나의 IP에 대한 하나의 도메인주소만 가질 수 있다
            - 화이트 도메인 구성에 사용된다

        - TXT(TeXT) :  도메인을 설명하는 일반 텍스트
            - 화이트 도메인을 위한 SPF로 사용될 수 있다
        
- DNS에서 알아둬야할 내용
    - 도메인 위임(DNS Delegation)
        - 자신의 도메인 관리 권한을 일부 위임해서 세부 레코드를 관리하도록 한다(CDN, GSLB)
            - 관리 주체를 분리하는 용도, 계열사에서 특정 도메인을 분리하거나 GSLB등 다양한 용도로 사용된다
        - 레코드를 위임하면 해당 레코드의 하위계층도 위임처리된다

    - TTL(Time To Live)
        - DNS에서 응답받은 결과값을 캐시에 유지하는 시간
            - TTL이 길면 부하가 줄고 응답이 빨라지지만 변경되면 정보갱신이 그만큼 지연된다
            - IDC이전이나 공인 IP, 서비스 변경을 할때 TTL값을 미리 극도로 줄여 정보갱신을 빠르게 할 수 있다
        
        - *도메인 관련 시간*
            - refrech(새로 고침 간격) : 보조 네임 서버에서 Zone Transfer로 정보를 받는 주기
            - retry(다시 시도 간격) : 보조 네임서버에서 주 네임서버로 접근 실패시 다시 시도하는 주기
            - expire(다음 날짜 이후 만료) : Zone Tranfer로 받아온 정보가 갱신되지 못할 경우 삭제하는 제한시간 

    - 화이트 도메인
        - 사전에 등록된 개인이나 사업자의 이메일 전송을 보장해주는 제도
            - 정상적인 대량 이메일이 RBL(Realtime Blackhole List, 블랙리스트)로 간주되어 차단되는 것을 방지
        
        - 화이트 도메인 등록을 위해서는 SPF(Sender Policy Framework)가 설정되어 있어야 한다
            - 윈도우에서 SPF등록시 길이를 초과하면 레코드 값이 모두 지워진다

    - 한글 도메인
        - 한글은 '퓨니코드'로 변경해서 도메인을 생성하면 한글 도메인을 만들 수 있다

        - 퓨니코드(Punycode)
            - IDNA 기반 하에서 다국어 도메인이 아스키로 변환된 구문
                - 유니코드 문자열을 인코딩 하는 것 

            - 퓨니코해에는 접두어 'xn--'가 붙는다
            - 퓨니코드 변환기로 변환된 값을 알 수 있다

    
- DNS 설정(Win)
    - 실행창에서 "ServerManager"를 입력해