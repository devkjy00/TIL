# 트리거
> 학습내용
- 트리거의 개요, 정의, 수정, 삭제

## 트리거(Trigger)의 개요
- 데이터베이스 서버에 특정한 사건이 발생했을 떄 자동으로 수행되는 특별한 형태의 저장 프로시저
- 종류
  - DML 기반 트리거 : INSERT, DELETE, UPDATE에 대해 실행
  - DDL 기반 트리거 : CREATE, ALTER, DROP과 일부 시스템 저장 프로시저에 대해 실행
  - LOGON 트리거 : 사용자 세션이 설정 될때 발생하는 LOGON 이벤트에 대한 응답으로 실행
  
## 트리거 정의
- T-SQL을 이용한 트리거의 정의 형식
  - DML 트리거 정의
    ```tsql
    CREATE TRIGGER trigger_name
    ON {table|view}         -- 트리거가 적용될 테이블 또는 뷰를 설정
    [ WITH ENCRYPTION ]
    { FOR | AFTER | INSTEAD OF } -- FOR | AFTER : 구문이 완료되면 실행되도록 설정
                                -- 구문의 실행 대신 실행되도록 설정
    { [ INSERT ] [ , ] [ UPDATE ] [ , ] [ DELETE ] } AS {
    sql_statement [ ; ] }
    ```
    
  - DDL 트리거 정의
    ```tsql
    CREATE TRIGGER trigger_name
    ON { ALL SERVER | DATABASE }    -- 트리거가 적용될 범위를 현재 데이터베이스 또는 서버로 설정
    [ WITH ENCRYPTION ]
    {FOR | AFTER} {event_type|event_group} [,...n] AS {
    sql_statement [ ; ]
    }
    ```

# 사용자 정의 함수
> 학습내용
- 사용자 정의 함수 정의, 수정, 삭제

## 사용자 정의 함수
- T-SQL을 이용한 정의
  - 스칼라 반환 함수
    ```sql
    CREATE FUNCTION function_name
    ( [ { @parameter_name [ AS ] parameter_data_type [=default] } [ , ...n ] ] ) 
    RETURNS return_data_type
      [ WITH <function_option> [ , ... n ] ] 
      [ AS ]
      BEGIN
        function_body
        RETURN scalar_expression 
      END
    [;]
    ```
    - function_body : 함수 본체에 사용되는 T-SQL문장
      - 데이터베이스를 갱신하는 문장들은 사용할 수 없다
    
    - 예제
      ```sql
      -- 정의 
      GO
      CREATE FUNTION func(@num1 int) 
      RETURN int
      AS
      BEGIN
        DECLARE @result int
        IF (@num1 > 0) SET @result = true
        ELSE SET @result = false
        RETURN @result
      END;
      GO
      
      -- 사용
      GO
      SELECT dbo.func(3);
      GO
      ```

  - 테이블 반환 함수
    ```sql
    CREATE FUNCTION function_name
    ( [ { @parameter_name [ AS ] parameter_data_type [=default] } [ , ...n ] ] ) 
    RETURNS TABLE
      [ WITH <function_option> [ , ... n ] ]    
      [ AS ]
      RETURN [ ( ] select_statement [ ) ]
    [;]
    ```
    - 예
      ```sql
      -- 정의
      GO
      CREATE FUCTION get_table()
      RETURN TABLE
      AS
      RETURN (SELECT * FROM table_1)
      GO

      -- 사용
      GO
      SELECT * FROM dbo.get_table();
      ```
    
- T-SQL을 이용한 수정
  ```sql
  -- 스칼라 반환 함수 수정
  ALTER FUNCTION function_name
  ( [ { @parameter_name [ AS ] parameter_data_type [=default] } [ , ...n ] ] ) 
  RETURNS return_data_type
    [ WITH <function_option> [ , ... n ] ] 
    [ AS ]
    BEGIN
      function_body
      RETURN scalar_expression 
    END
  [;]

  -- 테이블 반환 함수 수정
   ALTER FUNCTION function_name
  ( [ { @parameter_name [ AS ] parameter_data_type [=default] } [ , ...n ] ] ) 
  RETURNS TABLE
    [ WITH <function_option> [ , ... n ] ] 
    [ AS ]
    RETURN [ ( ] select_stmt [ ) ]
  [;]
  ```

- T-SQL을 이용한 삭제
  ```sql
  DROP FUCTION fuction_name
  ```
  - 삭제 할 때는 괄호를 사용하지 않는다