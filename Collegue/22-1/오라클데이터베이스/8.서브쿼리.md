# 단일 행 서브쿼리
> 학습내용
- 서브쿼리 개념 및 적용 가능 문제 파악
- 서브쿼리 사용 지침
- 단일 행 서브쿼리와 단일 행 비교 연산자
## 서브쿼리를 사용한 문제해결
``` sql
SELECT last_name, salary
FROM employees
WHERE salary >  
    (SELECT salary 
    FROM employees
    WHERE last_name = 'juyoung');
```
- 괄호 사용 필수
- 가독성을 위해 오른쪽에 배치
- 서브쿼리 결과 건수에 맞는 비교 연산자를 사용
    - 단일행 서브쿼리는 단일행 비교 연산자 사용
    - 다중 행 서브쿼리에는 다중 행 비교 연산자 사용
        - '=' -> 서브 쿼리를 IN()처럼 사용

- 서브 쿼리가 먼저 수행되고 메인 쿼리에 적용된다
## 단일 행 서브쿼리
- 개요
    - 한 행만 반환
    - 조건식에서 단일 행 비교 연산자 사용

- 쿼리 블록(query block)
    - 각 SELECT문으로 최적화 되는 단위이다

# 다중 행 서브쿼리
> 학습내용
- 다중 행 서브쿼리, 다중 행 비교 연산자
- 서브쿼리와 그룹 함수
- 서브쿼리와 NULL

## 다중 행 서브쿼리
- 한 행 이상 반환
- 조건식에서 다중 행 비교 연산자 사용
  - IN(서브쿼리) : =ANY()와 같다
  - 비교 연산자 ANY(서브쿼리) : 서브쿼리 결과의 OR 연산을 비교
    - ```< ANY(...)``` : 서브쿼리 결과값의 최대값보다 작은
    - ```> ANY(...)``` : 서브쿼리 결과값의 최소값보다 큰
  - 비교 연산자 ALL(서브쿼리) : 서브쿼리 결과의 AND 연산을 비교
    - ```< ALL(...)``` : 서브쿼리 결과값의 최소값보다 작은
    - ```> ALL(...)``` : 서브쿼리 결과값의 최대값보다 큰

- NOT의 위치 : NOT column 비교연산자 서브쿼리 형태로 사용

## 서브쿼리 그룹 함수시
- GROUP BY 미사용 -> 단일 행 서브쿼리
- GROUP BY 사용 -> 다중 행 서브쿼리

## 서브쿼리와 NULL
- 단일 행 서브쿼리 결과 값이 NULL 
  - WHERE col = NULL -> 메인 쿼리 결과도 NULL
  
- 다중 행 서브쿼리 결과 중 일부가 NULL
  - ANY, IN : 메인 쿼리 결과에 영향 없음(OR 연산)
  - ALL, NOT IN : 메인 쿼리 결과는 NULL(AND 연산)

# 상호관련 서브쿼리
> 학습내용
- 상호 관련 서브쿼리
- EXIST, NOT EXIST
- 서브쿼리 유형

## 상호관련 서브쿼리(Correlated subquery)
- 메인 쿼리와 서브 쿼리가 서로 영향을 미친다
  - 서브쿼리의 결과가 메인 쿼리의 행에 따라 달라진다
  - 메인 쿼리는 서브쿼리의 결과를 사용함

- 동작 방식
  - 메인 쿼리의 각 행에 대해 서브쿼리가 매번 실행된다
    - 비효율적, EXISTS 연산자를 사용하거나 조인으로 풀어서 작성 할 수 있다
  - 서브쿼리가 메인 쿼리의 후보행의 컬럼을 참조
  - *서브쿼리의 WHERE절에 메인테이블과 서브테이블 간 조인 조건 기술*
    - 메인 테이블과 서브테이블이 같은 경우 별칭을 사용해야 한다

- 중첩/상호관련 서브쿼리
  - 처리 순서 상이 : 중첩(서브쿼리 먼저), 상호관련(메인쿼리 먼저)
  - 중첩 서브쿼리는 단 한번 수행

## EXISTS
- 상호관련 서브쿼리의 결과가 존재하는지 검사
  ```sql
  SELECT col
  FROM table
  WHERE EXISTS(상호관련 서브쿼리)
  ```
  - select list는 1, 'x'등 간단한 리터럴 사용
    - EXISTS는 서브쿼리의 행의 존재 여부만 검사한다

- NOT EXISTS는 존재하지 않는 경우를 검사

## 서브쿼리 유형
- 단일 컬럼 서브쿼리
- 다중 컬럼 서브쿼리
  - 컬럼 개수, 순서 및 타입을 일치시킨다
  - 괄호로 묶어야한다
  ```sql
  SELECT col
  FROM table
  WHERE (A, B) IN (SELECT A, B
                  FROM table
                  WHERE predicate)
  ```

- 인라인 뷰(inline view)
  - FROM 절에 오는 서브쿼리(이름 없는 뷰, 임시 뷰, 임시 재료집합)

  - 테이블 별칭을 사용해야 한다
  - select-list가 표현식이면 컬럼 별칭을 사용

- 스칼라(scalar) 서브쿼리
  - 결과가 하나의 행, 하나의 컬럼인 서브쿼리
  - 작성 위치
    - DECODE, CASE, 표현식에 사용
    - GROUP BY를 제외한 모든 SELECT절
    - UPDATE의 SET, WHERE
    - INSERT의 VALUES

