# DBA의 역할과 오라클 데이터베이스 아키텍처
> 학습내용
- 오라클 데이터베이스 관리자의 역할
- Grid Infrastructure
- 오라클 데이터베이스의 메모리 구조와 백그라운드 프로세스
- 오라클 데이터베이스 저장 영역 구조

### 데이터 베이스 관리자(DBA)
- HA(High Availability, 고가용성)
	- 항상 서비스 가능한 상태로 유지, 장애시 빠른 복구 
	- DBA의 지상 최대 목표

### Oracle Database 11g: 그리드의 'g'
- 오라클 그리드 인프라스트럭처(Grid Infrastructure)
	- 구조
		- 저장 영역 그리드 : 자동 저장 영역관리(ASM)
			- DB
		- 데이터베이스 그리드 : Real Application Clusters(RAC)
			- 인스턴스
		- 응용 프로그램 그리드 : 응용 프로그램 서버 클러스터
		- Grid control : Enterprise Manager Grid Control

	- 여러 개의 데이터베이스, 인스턴스, 애플리케이션 서버들을 각각 클러스터화
	- 하나의 거대한 데이터베이스, 인스턴스, 애플리케이션 서버로 동작하게 하는 하부 구조
	- 장점 : 낮은 비용, 높은 서비스 품질, 편리한 관리

### 프로그램, 프로세스, 인스턴스, 스토리지
- 프로그램 	
	- 명령들의 집합
	- 아직 실행되지 않은 상태, 인스턴스와 스토리지의 상호작용에 의해 실행된다

- 프로세스
	- 프로그램이 메모리에 로드되어 CPU에 의해 명령들이 실행되고 있는 상태/단위

- 인스턴스
	- 프로그램이 실행을 위해 메모리에 로드된 것 
	- 하나의 인스턴스는 다수의 프로세스에 의해 실행됨
	- 프로세스는 현재 CPU가 실행 중인 작은 수행 단위

- 스토리지
	- 프로그램이 저장 되는 곳

### 오라클 데이터 베이스 아키텍처
- 아키텍처
	- 오라클 서버
		- 인스턴스(메모리 구조, 프로세스 구조)
		- 데이터베이스(저장 영역 구조)
	
- 오라클 서버의 주요 3대 구조
	- 메모리 구조 : SGA(시스템 메모리), PGA
	- 프로세스 구조 : Server Proc, BGP, User Proc
	- 스토리지 구조 : 컨트롤 파일, 데이터 파일, 리두 로그 파일

### 인스턴스와 데이터베이스의 관계
- 각 인스턴스는 단 한개의 데이터베이스만 연관
	- 한 컴퓨터에 여러 데이터베이스 -> 여러개의 인스턴스 존재
		- 클러스터화 되지 않은 시스템
	- RAC : 인스턴스 수준의 그리드 기술
		- 여러 인스턴스 의 묶음으로 하나의 데이터 베이스만 연관
	- ASM :  데이터베이스 수준의 그리드 기술
		- 여러 저장 장치가 하나의 데이터베이스로 인식

# 인스턴스
> 학습내용
- 메모리 구조
- 프로세스 구조
- 프로세스 시작 시퀀스

### 오라클 데이터베이스 메모리 구조
- SGA(System Global Area) : 공유 메모리
	- 인스터스에 관한 데이터, 사용자가 사용할 데이터 저장

- PGA(Program Global Area) : 전용 메모리
	- 프로세스에 관한 데이터 저장

### SGA 구조
- Shared Pool
	- 라이브러리 캐시 : SQL코드 재사용 목적(실행계획)
	- 데이터 딕셔너리 캐시 : 각종 정보를 빠르게 접근(로우 캐시)
	- 서버 결과 캐시 : 쿼리, 함수 결과를 저장
	- 예약 풀 : 큰 연속적인 메모리 공간(청크) 할당
	- LRU(Least Recently Used) 알고리즘 : 덜 사용되는 데이터 블록은 버퍼 캐시에서 밀려나도록 관리

- Buffer Cache
	- 데이터를 버퍼 및 캐시
		- 캐시 : 데이터 파일에서 *읽은 데이터*
		- 버퍼 : 서버 프로세스가 *처리한 데이터*
		- 프로세스가 처리하는 속도가 저장하는 속도보다 빠르기 때문에 메모리에 미리 저장
	
	- 블록 단위로 저장 : 기본 8KB, DB생성 후 변경 불가
	- LRU
	- nK Buffer Cache : 기본 블록 크기보다 작거나 큰 데이터 블록을 처리할 경우 저장

- Redo Log Buffer
	- DML, DDL, DCL의 모든 변경사항 기록(select 제외)
		- 순환 버퍼
		- 데이터 베이스 복구를 대비
	- 서버 프로세스
		- 리두 항목 생성후에 버퍼캐시에 변경사항 기록

- Large Pool 
	- 대규모 메모리가 필요한 작업 시 사용
	- 공유 서버아키텍처에서 
		- Request/Response Queue
	
	- 병렬 쿼리 수행시 
	- RMAN I/O 작업


### PGA
- 서버 및 백그라운드 프로세스의 데이터를 저장
- 프로세스의 전용 메모리
	- 커서 영역(Private SQL Area) : 커서의 런타임 정보 저장
		- select문, 쿼리 결과, 바인드 변수등
	
	- 유저 세션 데이터 저장 영역 : 이름, 권한등
	- SQL Work Area : 정렬, 해쉬, 비트맵

### 프로세스 아키텍처
- 유저 프로세스 : 서버에 접속하는 응용 프로그램(웹 서버, SQL Plus 등)
- 데이터베이스 프로세스
	- 서버 프로세스 : 세션 생성, 요청 처리
		- SQL문 구문 분석 및 실행
		- 디스크 파일의 데이터 블록을 버퍼 캐시로 읽음
	- 백그라운드 프로세스 : 오라클 서버를 운영
		- DBWn(DataBase Writer process) : 버퍼 캐시의 변경된 블록(더티 블록)을 데이터 파일로 저장(LRU)
			- 버퍼 캐시 공간이 부족할 때, 테이블 drop, truncate할 때 등 실행
			- 비동기 멀티 블록 쓰기 수행

		- LGWR(Log Writer process) : 리두 로그 버퍼의 내용을 로그 파일에 기록
			- 트랜잭션 커밋 시, 3초마다, 로그 스위치가 발생할 때 등 실행
			- Write Ahead Logging(WAL) : 데이터 및 데이터베이스 속성 변경 시 항상 로그에 먼저 기록
		- CKPT(CheckPoint process) : 메모리와 저장장치의 내용을 동기화
			- 커밋, DDL, DCL 수행등의 경우 수행
			- 모든 컨트롤 파일과 모든 데이터 파일의 헤더에 체크포인트 정보를 기록
				- 체크 포인트는 3초마다, 종료시 발생
				- 서버가 비정상 종료됬는지 확인가능
			- 인스턴스 복구 시간 단축 가능
				- 컨트롤 파일에 저장된 체크포인트 정보와 리두 로그 파일의 SCN 비교

		- SMON(System MONitor process) : 인스턴스 시작시 체크 포인트를 비교, 복구 자동 수행
		- PMON(Process MONitor process) 
			- 유저 프로세스 실패 시 프로세스 복구 수행
				- 버퍼 캐시 정리, 리소스 해제
``
			- 세션 모니터링

		- ARCn(ARChiver process) : 로그 스위치 발생시 온라인 리두 로그 파일을 지정된 저장소로 복사
			- 로그 스위치 : 리두 로그 파일을 변경하는 작업
			

			
# 데이터베이스
> 학습내용
- 데이터베이스 스토리지
- 논리적 및 물리적 데이터베이스 구조
- ASM(Automatic Storage Management)

### 데이터베이스 저장 영역(스토리지) 구조
- 데이터베이스 구성 요소(데이터 저장/복구 관련) : 컨트롤 파일, 데이터 파일, 온라인 리두 로그 파일

### 논리적/물리적 데이터베이스 구조
- 논리적 구조
	- 장점
		- 저장소의 물리적 한계 극복
			- 복수의 물리적 디스크를 하나의 논리적 디스크로 사용가능
		- OS 및 파일 시스템으로부터 독립
		- 효율적인 데이터 저장/처리 가능

	- 데이터 블록 : 데이터 최소 저당 단위, 기본 처리 단위

	- Extent : 단일 할당으로 얻은 연속적인 데이터 블록

	- 세그먼트 : 공간을 차지하는 데이터베이스 객체를 위한 논리적 구조
		- 데이터 세그먼트, 인덱스 세그먼트, 언두 세그먼트, 임시 세그먼트
		
	- 테이블 스페이스 : 세그먼트의 논리적 컨테이너
		- Smallfile TBS(1022파일, 4M블록)
		- Bigfile TBS(1파일, 4G블록)
	
### 테이블 스페이스
- SYSTEM 및 SYSAUX 테이블스페이스 : 필수 테이블 스페이스(DB 생성시 생성)
	- SYSTEM TBS
		- 오프라인 불가, 읽기 전용 불가
		- 데이터베이스의 핵심 기능을 지원하는 구성요소 저장(데이터 딕셔너리 테이블 등)
	
	- SYSAUX TBS
		- 항상 온라인, 복구 수행 시 오프라인 가능, 읽기 전용 불가
		- 추가적인 기능을 위한 구성 요소 저장

### ASM(Automatic Storage Management)
- 이식가능한 고성능 클러스터 파일 시스템
	- 클러스터화 : 나누어진 여러 개체를 묶어서 사용

- 주요 기능
	- 데이터를 여러 디스크에 분산, I/O로드가 균형을 이루도록 로드 밸런싱
	- Failure를 대비하여 데이터를 미러링
	- 복잡한 스토리지 관리 문제를 해결

- 저장 영역 구성 요소
	- ASM Disk : 디스크, 파티션, 플래시 카드등
		- 최소 단위인 ASM 할당 단위로 나뉜다
	
	- ASM Disk Group
		- 논리적 단위로 관리되는 ASM 디스크들의 집합
	
	- ASM Allocation Unit : ASM 기본 공간 할당 단위
		- 1MB(기본값), 2, 4, 8 ...
	
	- ASM Extent : ASM 파일의 내용을 저장
	- ASM File : ASM디스크 그룹위에 생성되는 파일, 오라클 서버가 사용
	

